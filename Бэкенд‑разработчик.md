**1.Подготовка инфраструктуры и архитектурного каркаса**

- Развернуть каркас микросервисов на Spring Boot по доменам: Auth, Person (персональные данные), Stats (статистика), Queue/Matchmaking, Game. Каждый сервис имеет свою базу данных и взаимодействует через REST и события.
    
- **API Gateway (опционально)**: Подготовить API Gateway (Nginx или Spring Cloud Gateway) для маршрутизации, аутентификации и rate-limiting. В текущей реализации сервисы доступны напрямую по разным портам. Gateway может быть добавлен для production-развертывания.
    
- Настроить хранилища: PostgreSQL для транзакционных данных, Redis для очередей и кэша.
    
- **Система сообщений (опционально)**: Настроить систему сообщений (RabbitMQ/Kafka) для рассылки событий между сервисами. В текущей реализации используется Redis для очереди матчмейкинга. RabbitMQ/Kafka могут быть добавлены на следующем этапе для масштабирования WebSocket и асинхронной обработки событий между сервисами.

**2.Регистрация и авторизация**

- Реализовать сервис Auth: эндпоинты `/v1/auth/registration` и `/v1/auth/login`, генерация и валидация JWT, хранение данных пользователя (email, никнейм). Для аутентификации используется Keycloak как Identity Provider. Используется версионирование API через префикс `/v1/`.
    
- Keycloak обеспечивает безопасное хранение паролей (использует PBKDF2/bcrypt/Argon2), генерацию JWT токенов, управление пользователями и ролями, поддержку OAuth2/OIDC, многофакторную аутентификацию и централизованное управление сессиями. Проверка паролей на утечку через Have I Been Pwned может быть реализована на уровне сервиса при регистрации.
    
- Поддержать сброс пароля и (опционально) многофакторную аутентификацию через Keycloak.

**3.Главный экран и профиль пользователя**

- Реализовать Profile Service: разделен на два сервиса:
  - `person-service` (`/v1/persons`) - хранит персональные данные пользователя (email, nickname)
  - `stats-service` (`/v1/stats`, `/v1/matches`) - предоставляет статистику, рейтинг и историю матчей
    
- Эндпоинт `/v1/profile` может быть реализован как агрегирующий эндпоинт в API Gateway, который объединяет данные из обоих сервисов (`person-service` и `stats-service`).

**4.Очередь и матчмейкинг**

- Реализовать сервис Matchmaking: хранение очереди в Redis Sorted Set и эндпоинты `/v1/queue/join` и `/v1/queue/leave`.
    
- Реализовать логику подбора соперника: по истечении 30 секунд либо сразу при наличии пары, с возможностью учитывать ELO‑рейтинг.
    
- Отправлять событие `match_found` через WebSocket `/ws/queue` обоим игрокам.

**5.Логика боя и игровая механика**
- Реализовать Game Service: создание матча, установка здоровья обоим игрокам и отправка события `turn_start` при начале хода.
    
- Принимать ходы (`/v1/game/move`), сохранять выборы атак/защит, обрабатывать тайм‑ауты 30 секунд и рассчитывать урон по правилам (голова — 20 HP, тело — 15 HP, ноги — 10 HP; защита снижает урон на 50 %).
    
- Отправлять события `turn_update`, `turn_result` и `game_end` через WebSocket `/ws/game/{matchId}`.
    
- Обновлять состояние HP и завершать матч при достижении нуля HP.

**6.Статистика и история матчей**

- Реализовать Stats Service: хранение истории матчей, победителей, длительности, ходов и API `/v1/matches` для получения списка матчей. Также предоставляет эндпоинт `/v1/stats` для получения статистики пользователя.
    
- Реализовать расчёт рейтинга/уровней (при необходимости) и агрегацию статистики.

**7.Реал‑тайм и устойчивость**

- Организовать надёжную работу WebSocket: выбрать стратегию масштабирования (RabbitMQ/ActiveMQ через STOMP или внешние сервисы Azure Web PubSub/AWS API Gateway).
    
- Настроить WebSocket‑прокси (Nginx/Envoy), sticky‑sessions и балансировщик нагрузки.
    
- Обработать разрывы соединений и переподключение клиентов.